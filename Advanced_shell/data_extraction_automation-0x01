#!/bin/bash

# data_extraction_automation-0x01
# Extract PokÃ©mon data from JSON with exact output formatting

# Check if data.json exists
if [[ ! -f "data.json" ]]; then
    echo "Error: data.json file not found." >&2
    exit 1
fi

# Extract raw data using jq
EXTRACTED_DATA=$(jq -r '
    .name + " " + 
    (.weight/10|tostring) + " " + 
    (.height/10|tostring) + " " + 
    .types[0].type.name
' data.json 2>/dev/null)

# Check if extraction worked
if [[ -z "$EXTRACTED_DATA" ]]; then
    echo "Error: Failed to extract data from JSON." >&2
    exit 1
fi

# Process with awk for exact formatting
echo "$EXTRACTED_DATA" | awk '{
    # Extract fields
    name = $1
    weight = $2 + 0  # Convert to number to remove .0 if present
    height = $3 + 0  # Convert to number to remove .0 if present
    type = $4
    
    # Capitalize first letter of type
    type = toupper(substr(type, 1, 1)) substr(type, 2)
    
    # Format weight - remove trailing .0 if present
    if (weight == int(weight)) {
        formatted_weight = sprintf("%d", weight)
    } else {
        formatted_weight = sprintf("%.1f", weight)
    }
    
    # Format height - remove trailing .0 if present  
    if (height == int(height)) {
        formatted_height = sprintf("%d", height)
    } else {
        formatted_height = sprintf("%.1f", height)
    }
    
    # Print EXACT format as required
    printf "%s is of type %s, weighs %skg, and is %sm tall.\n", 
           name, type, formatted_weight, formatted_height
}'
